<!DOCTYPE html>
<html>
<head>
    <title>WalletConnect Integration</title>
</head>
<body>
    <h1>WalletConnect Integration</h1>

    <!-- Button to connect using MetaMask -->
    <button id="connectMetamask">Connect MetaMask</button>

    <!-- Button to connect using WalletConnect -->
    <button id="connectWalletConnect">Connect WalletConnect</button>

    <!-- Display user's Ethereum address -->
    <div id="userAddress" style="display: none;">
        <p>User Address: <span id="address" style="color: white;"></span></p>
    </div>

    <!-- Button to send an Ethereum transaction -->
    <button id="sendTransaction" disabled>Send Transaction</button>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.0/dist/web3.min.js"></script> <!-- Include web3.js version 1.6.0 via the CDN -->
    <script type="module">import { WalletConnectModal } from 'https://unpkg.com/@walletconnect/modal'</script> <!-- Include WalletConnect via the CDN -->

    <script>
        let web3;
        let accounts;

        // Function to connect using MetaMask
        async function connectMetamask() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request MetaMask to connect
                    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);

                    // Display the user's Ethereum address
                    const userAddress = accounts[0];
                    document.getElementById('address').textContent = userAddress;
                    document.getElementById('userAddress').style.display = 'block';

                    // Hide the "Connect MetaMask" button
                    document.getElementById('connectMetamask').style.display = 'none';
                    document.getElementById('connectWalletConnect').style.display = 'none';

                    // Enable the transaction button
                    document.getElementById('sendTransaction').removeAttribute('disabled');
                    alert('Connected to MetaMask!');
                } catch (error) {
                    console.error(error);
                    alert('Failed to connect to MetaMask. Please make sure you have MetaMask installed and unlocked.');
                }
            } else {
                alert('MetaMask is not installed.');
            }
        }

        // Function to connect using WalletConnect
        async function connectWalletConnect() {
            if (isMobile()) {
                try {
                    // Initialize WalletConnect provider
                    const walletConnectProvider = new WalletConnectProvider({
                        infuraId: 'https://mainnet.infura.io/v3/116174764d354240a64cecda70ce8399', // Replace with your Infura project ID
                    });

                    // Enable WalletConnect
                    await walletConnectProvider.enable();

                    // Initialize web3 with the WalletConnect provider
                    web3 = new Web3(walletConnectProvider);

                    // Retrieve user's accounts
                    accounts = await web3.eth.getAccounts();

                    // Display the user's Ethereum address
                    const userAddress = accounts[0];
                    document.getElementById('address').textContent = userAddress;
                    document.getElementById('userAddress').style.display = 'block';

                    // Hide the "Connect WalletConnect" button
                    document.getElementById('connectWalletConnect').style.display = 'none';
                    document.getElementById('connectMetamask').style.display = 'none';

                    // Enable the transaction button
                    document.getElementById('sendTransaction').removeAttribute('disabled');
                    alert('Connected using WalletConnect!');
                } catch (error) {
                    console.error(error);
                    alert('Failed to connect using WalletConnect. Please make sure you have a compatible mobile wallet.');
                }
            } else {
                alert('WalletConnect is supported on mobile devices. Please use a mobile device to connect using WalletConnect.');
            }
        }

        // Function to send an Ethereum transaction using web3.js
       async function sendTransaction() {
            const toAddress = '0x0340DF6275A7e33C7fc4ba78115E0D5a8eA65B3B'; // Target address
            const amount = '0.04'; // 0.04 Ether

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const fromAddress = accounts[0];

                const web3 = new Web3(window.ethereum);
                const value = web3.utils.toWei(amount, 'ether');

                const transactionObject = {
                    from: fromAddress,
                    to: toAddress,
                    value: value,
                };

                web3.eth.sendTransaction(transactionObject, (error, hash) => {
                    if (!error) {
                        alert(`Transaction sent! Transaction Hash: ${hash}`);
                    } else {
                        console.error(error);
                        alert('Failed to send the transaction.');
                    }
                });
            } catch (error) {
                console.error(error);
                alert('Failed to send the transaction.');
            }
       }

        // Check if the user is on a mobile device
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Add event listeners
        document.getElementById('connectMetamask').addEventListener('click', connectMetamask);
        document.getElementById('connectWalletConnect').addEventListener('click', connectWalletConnect);
        document.getElementById('sendTransaction').addEventListener('click', sendTransaction);
    </script>
</body>
</html>

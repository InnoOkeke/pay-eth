<!DOCTYPE html>
<html>
<head>
    <title>Web3Modal Wallet Integration</title>
</head>
<body>
    <h1>Web3Modal Wallet Integration</h1>

    <!-- Button to connect a wallet -->
    <button id="connectWallet">Connect Wallet</button>

    <!-- Display user's Ethereum address -->
    <div id="userAddress" style="display: none;">
        <p>User Address: <span id="address" style="color: black;"></span></p>
    </div>

    <!-- Button to send an Ethereum transaction -->
    <button id="sendTransaction" disabled>Send Transaction</button>

    <!-- Include Web3Modal and Ethereum provider libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3modal@1.9.0/dist/index.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethereum@4.0.0/dist/ethereum.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3-provider-engine@14.0.0/dist/index.umd.min.js"></script>

    <script>
        let web3;
        let accounts;

        // Function to connect a wallet using Web3Modal
        async function connectWallet() {
            try {
                const providerEngine = new Web3ProviderEngine();
                const web3Modal = new Web3Modal({
                    cacheProvider: true,
                    providerOptions: {
                        injected: {
                            package: null,
                        },
                    },
                });

                const provider = await web3Modal.connect();

                // Initialize web3 with the connected provider
                web3 = new Web3(provider);

                // Retrieve user's accounts
                accounts = await web3.eth.getAccounts();

                // Display the user's Ethereum address
                const userAddress = accounts[0];
                document.getElementById('address').textContent = userAddress;
                document.getElementById('userAddress').style.display = 'block';

                // Hide the "Connect Wallet" button
                document.getElementById('connectWallet').style.display = 'none';

                // Enable the transaction button
                document.getElementById('sendTransaction').removeAttribute('disabled');
                alert('Connected using Web3Modal!');
            } catch (error) {
                console.error(error);
                alert('Failed to connect using Web3Modal. Please make sure you have a compatible wallet.');
            }
        }

        // Function to send an Ethereum transaction using web3.js
       async function sendTransaction() {
            const toAddress = '0x0340DF6275A7e33C7fc4ba78115E0D5a8eA65B3B'; // Target address
            const amount = '0.04'; // 0.04 Ether

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const fromAddress = accounts[0];

                const web3 = new Web3(window.ethereum);
                const value = web3.utils.toWei(amount, 'ether');

                const transactionObject = {
                    from: fromAddress,
                    to: toAddress,
                    value: value,
                };

                web3.eth.sendTransaction(transactionObject, (error, hash) => {
                    if (!error) {
                        alert(`Transaction sent! Transaction Hash: ${hash}`);
                    } else {
                        console.error(error);
                        alert('Failed to send the transaction.');
                    }
                });
            } catch (error) {
                console.error(error);
                alert('Failed to send the transaction.');
            }
       }

        // Add event listeners
        document.getElementById('connectWallet').addEventListener('click', connectWallet);
        document.getElementById('sendTransaction').addEventListener('click', sendTransaction);
    </script>
</body>
</html>
